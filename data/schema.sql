DROP DATABASE IF EXISTS `bilderdb`;
CREATE DATABASE IF NOT EXISTS `bilderdb`
  DEFAULT CHARACTER SET utf8
  COLLATE utf8_german2_ci;

USE bilderdb;

CREATE TABLE ROLE (
  RID         INT PRIMARY KEY,
  ROLE        VARCHAR(50),
  DESCRIPTION VARCHAR(100)
);

CREATE TABLE USER (
  UID       INT PRIMARY KEY AUTO_INCREMENT,
  EMAIL     VARCHAR(50),
  FIRSTNAME VARCHAR(50),
  SURENAME  VARCHAR(50),
  PASSWORD  VARCHAR(60),
  ROLE      INT,
  FOREIGN KEY (ROLE) REFERENCES ROLE(RID)
);

CREATE TABLE PICTURE (
  PID         INT PRIMARY KEY AUTO_INCREMENT,
  PICTURE     VARCHAR(100),
  THUMB       varchar(100),
  TITLE       VARCHAR(50),
  DESCRIPTION VARCHAR(100)
);

CREATE TABLE GALLERIE (
  GID INT PRIMARY KEY AUTO_INCREMENT,
  NAME VARCHAR (50),
  DESCRIPTION VARCHAR (10000)
);

CREATE TABLE TAGS (
  TID         INT PRIMARY KEY AUTO_INCREMENT,
  TAG         VARCHAR(50),
  DESCRIPTION VARCHAR(100)
);

CREATE TABLE TAG_PICTURE(
  TPID        INT PRIMARY KEY AUTO_INCREMENT,
  TID         INT,
  PID         INT,
  FOREIGN KEY (TID) REFERENCES TAGS(TID),
  FOREIGN KEY (PID) REFERENCES PICTURE(PID) on delete CASCADE
);

CREATE TABLE GALLERIE_PICTURE (
  GPID INT PRIMARY KEY AUTO_INCREMENT,
  GID  INT,
  PID  INT,
  FOREIGN KEY (GID) REFERENCES GALLERIE(GID) on delete cascade,
  FOREIGN KEY (PID) REFERENCES PICTURE(PID) on delete cascade
);

CREATE TABLE GALLERIE_USER(
  GUID INT PRIMARY KEY AUTO_INCREMENT,
  GID INT,
  UID INT,
  RID INT,
  FOREIGN KEY (GID) REFERENCES GALLERIE(GID) on delete CASCADE ,
  FOREIGN KEY (UID) REFERENCES USER(UID) on DELETE cascade,
  FOREIGN KEY (RID) REFERENCES ROLE(RID)
);

INSERT INTO ROLE VALUES (1, "Admin", "Admin");
INSERT INTO ROLE VALUES (2, "User", "Wenn der Benutzer Registriert und Eingeloggt ist.");
INSERT INTO ROLE VALUES (3, "Besitzer", "Der Besitzer einer Gallerie");
INSERT INTO ROLE VALUES (4, "Freigegeben Für", "Wenn die Gallerie Freigegeben ist für eine Person");

INSERT INTO USER (UID,EMAIL,FIRSTNAME,SURENAME,PASSWORD,ROLE) VALUES (1, "admin@gmail.com", "Admin", "Root", "$2y$10$ZW8lhRjDakWqODqVFDYHL.0X0aMkQh5POs.d5TcKuIcLwEYVqmHAa", 1);
INSERT INTO USER VALUES (2, "user@gmail.com", "User", "Fritz", "9f8a2389a20ca0752aa9e95093515517e90e194c", 2);